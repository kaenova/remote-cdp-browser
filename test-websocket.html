<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chrome CDP WebSocket Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .container {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 8px;
            margin: 10px 0;
        }
        button {
            background: #007cba;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #005a8b;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        #log {
            background: #1e1e1e;
            color: #f0f0f0;
            padding: 15px;
            border-radius: 4px;
            height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            white-space: pre-wrap;
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .connected {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .disconnected {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .target-item {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            margin: 5px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .target-info {
            flex: 1;
        }
        .target-title {
            font-weight: bold;
            margin-bottom: 5px;
        }
        .target-url {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
        }
        .target-type {
            font-size: 10px;
            background: #007cba;
            color: white;
            padding: 2px 6px;
            border-radius: 3px;
        }
        .target-actions {
            display: flex;
            gap: 5px;
        }
        .target-actions button {
            font-size: 12px;
            padding: 5px 10px;
        }
        .screenshot-btn {
            background: #28a745;
        }
        .screenshot-btn:hover {
            background: #218838;
        }
        .connect-btn {
            background: #17a2b8;
        }
        .connect-btn:hover {
            background: #138496;
        }
        #screenshot-container {
            text-align: center;
        }
        #screenshot {
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <h1>Chrome CDP WebSocket Test & Tab Manager</h1>
    <p>This page tests the WebSocket forwarding functionality of the Remote CDP Browser proxy and provides visual tab management with screenshot capabilities.</p>

    <div class="container">
        <h3>Connection Status</h3>
        <div id="status" class="status disconnected">Disconnected</div>
        <button id="connectBtn" onclick="connect()">Connect</button>
        <button id="disconnectBtn" onclick="disconnect()" disabled>Disconnect</button>
    </div>

    <div class="container">
        <h3>Tab Management</h3>
        <button onclick="refreshTargets()">Refresh Tabs</button>
        <button onclick="createNewTab()">Create New Tab</button>
        <div id="targets"></div>
    </div>

    <div class="container">
        <h3>CDP Commands</h3>
        <button onclick="sendCommand('Runtime.evaluate', {expression: 'window.location.href'})">Get Current URL</button>
        <button onclick="sendCommand('Runtime.evaluate', {expression: 'document.title'})">Get Page Title</button>
        <button onclick="sendCommand('Runtime.evaluate', {expression: 'navigator.userAgent'})">Get User Agent</button>
        <button onclick="sendCommand('Page.getResourceTree')">Get Resource Tree</button>
        <button onclick="sendCommand('Network.enable')">Enable Network</button>
        <button onclick="sendCommand('Runtime.enable')">Enable Runtime</button>
        <button onclick="captureScreenshot()">Take Screenshot</button>
        <button onclick="enablePageEvents()">Enable Page Events</button>
    </div>

    <div class="container">
        <h3>Browser Interaction</h3>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px;">
            <div>
                <h4>Navigation</h4>
                <input type="text" id="navigationUrl" placeholder="https://example.com" style="width: 100%; margin-bottom: 5px;">
                <button onclick="navigateToUrl()">Navigate</button>
                <button onclick="goBack()">Back</button>
                <button onclick="goForward()">Forward</button>
                <button onclick="reload()">Reload</button>
                <div style="margin-top: 5px; font-size: 0.8em;">
                    <strong>Quick:</strong>
                    <button onclick="quickNavigate('https://google.com')" style="font-size: 0.7em; padding: 2px 4px;">Google</button>
                    <button onclick="quickNavigate('https://github.com')" style="font-size: 0.7em; padding: 2px 4px;">GitHub</button>
                    <button onclick="quickNavigate('https://stackoverflow.com')" style="font-size: 0.7em; padding: 2px 4px;">SO</button>
                </div>
            </div>
            <div>
                <h4>Page Interaction</h4>
                <button onclick="scrollToTop()">Scroll to Top</button>
                <button onclick="scrollToBottom()">Scroll to Bottom</button>
                <button onclick="clickElement()">Click Element</button>
                <button onclick="focusElement()">Focus Element</button>
            </div>
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
            <div>
                <h4>Mouse Actions</h4>
                <div style="margin-bottom: 10px;">
                    <label>X: <input type="number" id="mouseX" value="100" style="width: 60px;"></label>
                    <label>Y: <input type="number" id="mouseY" value="100" style="width: 60px;"></label>
                </div>
                <button onclick="mouseClick()">Click at X,Y</button>
                <button onclick="mouseMove()">Move to X,Y</button>
                <button onclick="rightClick()">Right Click</button>
                <button onclick="doubleClick()">Double Click</button>
            </div>
            <div>
                <h4>Keyboard Actions</h4>
                <input type="text" id="textInput" placeholder="Text to type" style="width: 100%; margin-bottom: 5px;">
                <button onclick="typeText()">Type Text</button>
                <button onclick="pressKey('Enter')">Press Enter</button>
                <button onclick="pressKey('Escape')">Press Escape</button>
                <button onclick="pressKey('Tab')">Press Tab</button>
            </div>
        </div>
    </div>

    <div class="container">
        <h3>Element Inspector</h3>
        <div style="margin-bottom: 10px;">
            <input type="text" id="elementSelector" placeholder="CSS selector (e.g., #myId, .myClass, button)" style="width: 70%;">
            <button onclick="inspectElement()">Inspect</button>
        </div>
        <div id="elementInfo" style="background: #f9f9f9; padding: 10px; border-radius: 4px; min-height: 50px;">
            Element information will appear here
        </div>
    </div>

    <div class="container">
        <h3>Screenshot Preview</h3>
        <div id="screenshot-container">
            <img id="screenshot" style="max-width: 100%; border: 1px solid #ccc; display: none;" alt="Page Screenshot">
            <p id="screenshot-status">No screenshot taken yet</p>
        </div>
    </div>

    <div class="container">
        <h3>Log Output</h3>
        <button onclick="clearLog()">Clear Log</button>
        <div id="log"></div>
    </div>

    <script>
        let ws = null;
        let commandId = 1;
        let targetId = null;

        function log(message) {
            const logElement = document.getElementById('log');
            const timestamp = new Date().toISOString();
            logElement.textContent += `[${timestamp}] ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
        }

        function updateStatus(connected) {
            const statusElement = document.getElementById('status');
            const connectBtn = document.getElementById('connectBtn');
            const disconnectBtn = document.getElementById('disconnectBtn');
            
            if (connected) {
                statusElement.textContent = 'Connected';
                statusElement.className = 'status connected';
                connectBtn.disabled = true;
                disconnectBtn.disabled = false;
            } else {
                statusElement.textContent = 'Disconnected';
                statusElement.className = 'status disconnected';
                connectBtn.disabled = false;
                disconnectBtn.disabled = true;
            }
        }

        async function getFirstTarget() {
            try {
                const response = await fetch('http://localhost:8080/json/list');
                const targets = await response.json();
                const pageTargets = targets.filter(t => t.type === 'page');
                
                if (pageTargets.length > 0) {
                    return pageTargets[0].id;
                } else {
                    log('No page targets found, creating new target...');
                    const newResponse = await fetch('http://localhost:8080/json/new');
                    const newTarget = await newResponse.json();
                    return newTarget.id;
                }
            } catch (error) {
                log(`Error getting target: ${error.message}`);
                return null;
            }
        }

        async function connect() {
            try {
                targetId = await getFirstTarget();
                if (!targetId) {
                    log('Failed to get target ID');
                    return;
                }

                log(`Connecting to target: ${targetId}`);
                
                ws = new WebSocket(`ws://localhost:8080/devtools/page/${targetId}`);
                
                ws.onopen = () => {
                    log('WebSocket connected successfully!');
                    updateStatus(true);
                };
                
                ws.onmessage = (event) => {
                    try {
                        const data = JSON.parse(event.data);
                        log(`Received: ${JSON.stringify(data, null, 2)}`);
                    } catch (error) {
                        log(`Received (raw): ${event.data}`);
                    }
                };
                
                ws.onclose = (event) => {
                    log(`WebSocket closed: ${event.code} ${event.reason}`);
                    updateStatus(false);
                    ws = null;
                };
                
                ws.onerror = (error) => {
                    log(`WebSocket error: ${error}`);
                    updateStatus(false);
                };

            } catch (error) {
                log(`Connection error: ${error.message}`);
            }
        }

        function disconnect() {
            if (ws) {
                ws.close();
                ws = null;
            }
        }

        function sendCommand(method, params = {}) {
            if (!ws || ws.readyState !== WebSocket.OPEN) {
                log('WebSocket not connected');
                return;
            }

            const command = {
                id: commandId++,
                method: method,
                params: params
            };

            log(`Sending: ${JSON.stringify(command, null, 2)}`);
            ws.send(JSON.stringify(command));
        }

        function clearLog() {
            document.getElementById('log').textContent = '';
        }

        // Tab Management Functions
        async function refreshTargets() {
            try {
                const response = await fetch('http://localhost:8080/json/list');
                const targets = await response.json();
                displayTargets(targets);
                log(`Found ${targets.length} targets`);
            } catch (error) {
                log(`Error fetching targets: ${error.message}`);
            }
        }

        async function createNewTab() {
            try {
                const response = await fetch('http://localhost:8080/json/new?about:blank');
                const newTarget = await response.json();
                log(`Created new tab: ${newTarget.id}`);
                await refreshTargets();
            } catch (error) {
                log(`Error creating new tab: ${error.message}`);
            }
        }

        function displayTargets(targets) {
            const targetsContainer = document.getElementById('targets');
            targetsContainer.innerHTML = '';

            targets.forEach(target => {
                const targetDiv = document.createElement('div');
                targetDiv.className = 'target-item';
                
                const infoDiv = document.createElement('div');
                infoDiv.className = 'target-info';
                
                const titleDiv = document.createElement('div');
                titleDiv.className = 'target-title';
                titleDiv.textContent = target.title || 'Untitled';
                
                const urlDiv = document.createElement('div');
                urlDiv.className = 'target-url';
                urlDiv.textContent = target.url || 'No URL';
                
                const typeDiv = document.createElement('div');
                typeDiv.className = 'target-type';
                typeDiv.textContent = target.type || 'unknown';
                
                infoDiv.appendChild(titleDiv);
                infoDiv.appendChild(urlDiv);
                infoDiv.appendChild(typeDiv);
                
                const actionsDiv = document.createElement('div');
                actionsDiv.className = 'target-actions';
                
                const connectBtn = document.createElement('button');
                connectBtn.textContent = 'Connect';
                connectBtn.className = 'connect-btn';
                connectBtn.onclick = () => connectToTarget(target.id);
                
                const screenshotBtn = document.createElement('button');
                screenshotBtn.textContent = 'Screenshot';
                screenshotBtn.className = 'screenshot-btn';
                screenshotBtn.onclick = () => takeTargetScreenshot(target.id);
                
                actionsDiv.appendChild(connectBtn);
                if (target.type === 'page') {
                    actionsDiv.appendChild(screenshotBtn);
                }
                
                targetDiv.appendChild(infoDiv);
                targetDiv.appendChild(actionsDiv);
                targetsContainer.appendChild(targetDiv);
            });
        }

        async function connectToTarget(id) {
            if (ws && ws.readyState === WebSocket.OPEN) {
                disconnect();
            }
            
            targetId = id;
            await connect();
        }

        // Screenshot Functions
        function captureScreenshot() {
            if (!ws || ws.readyState !== WebSocket.OPEN) {
                log('WebSocket not connected');
                return;
            }

            const command = {
                id: commandId++,
                method: 'Page.captureScreenshot',
                params: {
                    format: 'png',
                    quality: 80,
                    clip: {
                        x: 0,
                        y: 0,
                        width: 1280,
                        height: 720,
                        scale: 1
                    }
                }
            };

            log(`Taking screenshot...`);
            
            // Store the command ID to handle the response
            window.screenshotCommandId = command.id;
            
            ws.send(JSON.stringify(command));
        }

        async function takeTargetScreenshot(targetId) {
            try {
                // Create a temporary WebSocket connection for this screenshot
                const tempWs = new WebSocket(`ws://localhost:8080/devtools/page/${targetId}`);
                
                tempWs.onopen = () => {
                    const command = {
                        id: 1,
                        method: 'Page.captureScreenshot',
                        params: {
                            format: 'png',
                            quality: 80
                        }
                    };
                    tempWs.send(JSON.stringify(command));
                };
                
                tempWs.onmessage = (event) => {
                    try {
                        const data = JSON.parse(event.data);
                        if (data.result && data.result.data) {
                            displayScreenshot(data.result.data);
                            log(`Screenshot taken for target ${targetId}`);
                        }
                    } catch (error) {
                        log(`Error processing screenshot: ${error.message}`);
                    }
                    tempWs.close();
                };
                
                tempWs.onerror = (error) => {
                    log(`Error taking screenshot for target ${targetId}: ${error}`);
                };
                
            } catch (error) {
                log(`Error creating screenshot connection: ${error.message}`);
            }
        }

        function displayScreenshot(base64Data) {
            const img = document.getElementById('screenshot');
            const status = document.getElementById('screenshot-status');
            
            if (base64Data) {
                img.src = `data:image/png;base64,${base64Data}`;
                img.style.display = 'block';
                img.style.cursor = 'crosshair';
                img.onclick = updateMouseFromScreenshot;
                status.style.display = 'none';
                log('Screenshot updated - Click on screenshot to set mouse position');
            } else {
                img.style.display = 'none';
                status.style.display = 'block';
                status.textContent = 'Failed to capture screenshot';
            }
        }

        function enablePageEvents() {
            if (!ws || ws.readyState !== WebSocket.OPEN) {
                log('WebSocket not connected');
                return;
            }

            // Enable Page domain to get page events
            sendCommand('Page.enable');
            sendCommand('Runtime.enable');
            sendCommand('Input.enable');
            log('Enabled Page, Runtime, and Input domains for events');
        }

        // Browser Navigation Functions
        function navigateToUrl() {
            const url = document.getElementById('navigationUrl').value;
            if (!url) {
                log('Please enter a URL');
                return;
            }
            
            sendCommand('Page.navigate', { url: url });
            log(`Navigating to: ${url}`);
        }

        function goBack() {
            sendCommand('Page.goBack');
            log('Going back');
        }

        function goForward() {
            sendCommand('Page.goForward');
            log('Going forward');
        }

        function reload() {
            sendCommand('Page.reload');
            log('Reloading page');
        }

        // Page Interaction Functions
        function scrollToTop() {
            sendCommand('Runtime.evaluate', {
                expression: 'window.scrollTo(0, 0)'
            });
            log('Scrolling to top');
        }

        function scrollToBottom() {
            sendCommand('Runtime.evaluate', {
                expression: 'window.scrollTo(0, document.body.scrollHeight)'
            });
            log('Scrolling to bottom');
        }

        function clickElement() {
            const selector = document.getElementById('elementSelector').value || 'body';
            const script = `
                const element = document.querySelector('${selector}');
                if (element) {
                    const rect = element.getBoundingClientRect();
                    ({
                        success: true,
                        x: rect.left + rect.width / 2,
                        y: rect.top + rect.height / 2,
                        element: element.tagName + (element.id ? '#' + element.id : '') + (element.className ? '.' + element.className.split(' ').join('.') : '')
                    });
                } else {
                    ({ success: false, error: 'Element not found' });
                }
            `;
            
            const evalCommand = {
                id: commandId++,
                method: 'Runtime.evaluate',
                params: {
                    expression: script,
                    returnByValue: true
                }
            };
            
            // Store command ID for handling response
            window.clickElementCommandId = evalCommand.id;
            
            log(`Finding element: ${selector}`);
            ws.send(JSON.stringify(evalCommand));
        }

        function focusElement() {
            const selector = document.getElementById('elementSelector').value || 'input, textarea, button';
            sendCommand('Runtime.evaluate', {
                expression: `
                    const element = document.querySelector('${selector}');
                    if (element) {
                        element.focus();
                        'Element focused: ' + element.tagName;
                    } else {
                        'Element not found';
                    }
                `,
                returnByValue: true
            });
            log(`Focusing element: ${selector}`);
        }

        // Mouse Functions
        function mouseClick() {
            const x = parseInt(document.getElementById('mouseX').value) || 100;
            const y = parseInt(document.getElementById('mouseY').value) || 100;
            
            sendCommand('Input.synthesizeClick', {
                x: x,
                y: y,
                button: 'left',
                clickCount: 1
            });
            log(`Clicking at coordinates (${x}, ${y})`);
        }

        function mouseMove() {
            const x = parseInt(document.getElementById('mouseX').value) || 100;
            const y = parseInt(document.getElementById('mouseY').value) || 100;
            
            sendCommand('Input.dispatchMouseEvent', {
                type: 'mouseMoved',
                x: x,
                y: y
            });
            log(`Moving mouse to (${x}, ${y})`);
        }

        function rightClick() {
            const x = parseInt(document.getElementById('mouseX').value) || 100;
            const y = parseInt(document.getElementById('mouseY').value) || 100;
            
            sendCommand('Input.synthesizeClick', {
                x: x,
                y: y,
                button: 'right',
                clickCount: 1
            });
            log(`Right clicking at (${x}, ${y})`);
        }

        function doubleClick() {
            const x = parseInt(document.getElementById('mouseX').value) || 100;
            const y = parseInt(document.getElementById('mouseY').value) || 100;
            
            sendCommand('Input.synthesizeClick', {
                x: x,
                y: y,
                button: 'left',
                clickCount: 2
            });
            log(`Double clicking at (${x}, ${y})`);
        }

        // Keyboard Functions
        function typeText() {
            const text = document.getElementById('textInput').value;
            if (!text) {
                log('Please enter text to type');
                return;
            }
            
            sendCommand('Input.insertText', {
                text: text
            });
            log(`Typing: "${text}"`);
        }

        function pressKey(key) {
            sendCommand('Input.dispatchKeyEvent', {
                type: 'keyDown',
                key: key
            });
            
            setTimeout(() => {
                sendCommand('Input.dispatchKeyEvent', {
                    type: 'keyUp',
                    key: key
                });
            }, 50);
            
            log(`Pressing key: ${key}`);
        }

        // Element Inspector Function
        function inspectElement() {
            const selector = document.getElementById('elementSelector').value;
            if (!selector) {
                log('Please enter a CSS selector');
                return;
            }
            
            const script = `
                const element = document.querySelector('${selector}');
                if (element) {
                    const rect = element.getBoundingClientRect();
                    const computedStyle = window.getComputedStyle(element);
                    ({
                        success: true,
                        tagName: element.tagName,
                        id: element.id,
                        className: element.className,
                        textContent: element.textContent.substring(0, 100),
                        attributes: Array.from(element.attributes).map(attr => ({name: attr.name, value: attr.value})),
                        boundingRect: {
                            x: rect.x,
                            y: rect.y,
                            width: rect.width,
                            height: rect.height
                        },
                        styles: {
                            display: computedStyle.display,
                            position: computedStyle.position,
                            color: computedStyle.color,
                            backgroundColor: computedStyle.backgroundColor,
                            fontSize: computedStyle.fontSize
                        },
                        isVisible: rect.width > 0 && rect.height > 0 && computedStyle.display !== 'none'
                    });
                } else {
                    ({ success: false, error: 'Element not found' });
                }
            `;
            
            const evalCommand = {
                id: commandId++,
                method: 'Runtime.evaluate',
                params: {
                    expression: script,
                    returnByValue: true
                }
            };
            
            // Store command ID for handling response
            window.inspectElementCommandId = evalCommand.id;
            
            log(`Inspecting element: ${selector}`);
            ws.send(JSON.stringify(evalCommand));
        }

        // Override the existing onmessage handler to handle screenshot responses
        const originalConnect = connect;
        connect = async function() {
            await originalConnect();
            
            // Override the message handler to handle screenshots and interactions
            if (ws) {
                ws.onmessage = (event) => {
                    try {
                        const data = JSON.parse(event.data);
                        
                        // Handle screenshot responses
                        if (data.id === window.screenshotCommandId && data.result && data.result.data) {
                            displayScreenshot(data.result.data);
                            delete window.screenshotCommandId;
                        }
                        
                        // Handle element inspection responses
                        else if (data.id === window.inspectElementCommandId && data.result) {
                            handleElementInspectionResult(data.result);
                            delete window.inspectElementCommandId;
                        }
                        
                        // Handle click element responses
                        else if (data.id === window.clickElementCommandId && data.result) {
                            handleClickElementResult(data.result);
                            delete window.clickElementCommandId;
                        }
                        
                        log(`Received: ${JSON.stringify(data, null, 2)}`);
                    } catch (error) {
                        log(`Received (raw): ${event.data}`);
                    }
                };
            }
        };

        function handleElementInspectionResult(result) {
            const elementInfo = document.getElementById('elementInfo');
            
            if (result.value && result.value.success) {
                const info = result.value;
                elementInfo.innerHTML = `
                    <h4>Element Found</h4>
                    <p><strong>Tag:</strong> ${info.tagName}</p>
                    ${info.id ? `<p><strong>ID:</strong> ${info.id}</p>` : ''}
                    ${info.className ? `<p><strong>Class:</strong> ${info.className}</p>` : ''}
                    <p><strong>Position:</strong> (${Math.round(info.boundingRect.x)}, ${Math.round(info.boundingRect.y)})</p>
                    <p><strong>Size:</strong> ${Math.round(info.boundingRect.width)} × ${Math.round(info.boundingRect.height)}</p>
                    <p><strong>Visible:</strong> ${info.isVisible ? 'Yes' : 'No'}</p>
                    <p><strong>Text:</strong> ${info.textContent ? info.textContent.substring(0, 50) + '...' : 'None'}</p>
                    <p><strong>Display:</strong> ${info.styles.display}</p>
                    <p><strong>Color:</strong> ${info.styles.color}</p>
                    ${info.attributes.length > 0 ? `<p><strong>Attributes:</strong> ${info.attributes.map(attr => `${attr.name}="${attr.value}"`).join(', ')}</p>` : ''}
                `;
                
                // Update mouse coordinates to element center
                document.getElementById('mouseX').value = Math.round(info.boundingRect.x + info.boundingRect.width / 2);
                document.getElementById('mouseY').value = Math.round(info.boundingRect.y + info.boundingRect.height / 2);
                
                log(`Element inspected successfully`);
            } else {
                elementInfo.innerHTML = `<p style="color: red;">Element not found</p>`;
                log(`Element inspection failed: ${result.value ? result.value.error : 'Unknown error'}`);
            }
        }

        function handleClickElementResult(result) {
            if (result.value && result.value.success) {
                const info = result.value;
                
                // Click at the element's center
                sendCommand('Input.synthesizeClick', {
                    x: info.x,
                    y: info.y,
                    button: 'left',
                    clickCount: 1
                });
                
                log(`Clicked element: ${info.element} at (${Math.round(info.x)}, ${Math.round(info.y)})`);
                
                // Update mouse coordinates
                document.getElementById('mouseX').value = Math.round(info.x);
                document.getElementById('mouseY').value = Math.round(info.y);
            } else {
                log(`Click failed: ${result.value ? result.value.error : 'Element not found'}`);
            }
        }

        // Utility functions
        function clearElementInfo() {
            document.getElementById('elementInfo').innerHTML = '<p>No element inspected</p>';
        }

        function updateMouseFromScreenshot(event) {
            const rect = event.target.getBoundingClientRect();
            const x = Math.round(event.clientX - rect.left);
            const y = Math.round(event.clientY - rect.top);
            
            document.getElementById('mouseX').value = x;
            document.getElementById('mouseY').value = y;
            
            log(`Mouse position updated to: (${x}, ${y})`);
        }

        function quickNavigate(url) {
            document.getElementById('navigateUrl').value = url;
            navigateToUrl(url);
        }

        // Initialize
        updateStatus(false);
        log('Chrome CDP WebSocket Test initialized');
        log('Click "Refresh Tabs" to see available Chrome tabs');
        log('Click "Connect" to establish WebSocket connection to Chrome CDP');
        
        // Auto-refresh targets on page load
        setTimeout(refreshTargets, 1000);
    </script>
</body>
</html>